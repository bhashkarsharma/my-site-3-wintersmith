<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimal-ui">
    <title>Hacking Django-Piston - Bhashkar Sharma
    </title>
    <link rel="canonical" href="http://rockerhome.wordpress.com/2012/05/06/hacking-django-piston/">
    <link rel="alternate" href="http://bhashkar.me/feed.xml" type="application/rss+xml" title="Dreamer. Tinkerer.">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Anonymous+Pro:400,700,400italic,700italic|Merriweather:400,700,300">
    <link rel="stylesheet" href="/css/main.css">
    <script src="/js/jquery.min.js"></script>
  </head>
  <body class="article-detail">
    <header class="header">
      <div class="content-wrap">
        <div class="logo"><a href="http://bhashkar.me"></a></div>
        <h1 class="title"><a href="http://bhashkar.me">Bhashkar Sharma</a></h1>
        <p class="description">Dreamer. Tinkerer.</p>
        <h1>Hacking Django-Piston</h1>
        <p class="date"><span>06. May 2012</span></p>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article">
          <section class="content"><p>At <a href="http://mobstac.com">MobStac</a>, we are working on building <span class="caps">REST</span> API support for the system. After evaluating various REST API framworks for <a href="http://djangoproject.com/">django</a>, I chose to go with <a href="https://bitbucket.org/jespern/django-piston/">django-piston</a>.<span class="more"></span></p>
<p>Trust me, there is hundreds of pages such as <a href="http://stackoverflow.com/questions/656979/django-and-restful-apis">this one</a> debating on which framework to go with, and amongst the top choices (alongside piston) were <a href="http://django-rest-framework.org/">Django <span class="caps">REST</span> Framework</a>, <a href="http://code.google.com/p/django-rest-interface/wiki/RestifyDjango">RESTify Django</a> and&nbsp;others. </p>
<p>The reason we chose to go with piston is because of the use case we had; which is: an already existing web <span class="caps">UI</span> to perform actions, to which (at least for now) the API is going to be a supporting component. Piston is quite well-written, comes with out-of-the-box support for standard output formats (XML, JSON, YAML) and has Basic HTTP Authentication and OAuth built&nbsp;in.</p>
<p>The down-sides, on the other hand, are that it is not well maintained, and there exist almost 150 forks to it, which people created to solve their own problem set. It would have been much better had there been an active support community and integrating features into&nbsp;piston.</p>
<p>One thing I did not understand is the reason to why the author himself has forked it to create another repo that supports OAuth2. I mean, OAuth2 has essentially become the de-facto standard and OAuth has been phased out, especially by the majors (twitter and&nbsp;facebook).</p>
<p>I personally think it would have made more sense to deprecate OAuth support from the main branch.&nbsp;Anyways.</p>
<p>[<strong>Update: </strong>After reading <a href="http://hueniverse.com/2012/07/oauth-2-0-and-the-road-to-hell/">this article</a> I want to take back what I said above about OAuth&nbsp;2.0.]</p>
<p>As has been my experience with using the plug-and-play frameworks, there are rarely the ones which, essentially, just work to suit your use case. I experienced the same thing when I was building the MobStac Authentication module and tried using <a href="https://bitbucket.org/ubernostrum/django-registration/">django-registration</a>. It worked for a while, but soon we outgrew it’s capabilities (when we had to start adding support for Facebook/Twitter OAuth2 integration, or payment for example). Eventually we had to scrap it and write our own Auth module which, so far, has scaled well. Although there are traces of designs from django-registration remaining, which I intend to get rid of at some point of time. Piston was a similar case. It lacked support for customizing response keys if you wanted to use a Model handler. Let me explain. Django is built on the <span class="caps">MVC</span> architecture, except that its more MTV (Model-Template-View). A typical model looks&nbsp;such: </p>
<pre><code class="lang-python"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="number">256</span>, db_index=<span class="keyword">True</span>)
    author = models.CharField(max_length=<span class="number">512</span>, db_index=<span class="keyword">True</span>)
    published = models.DateTimeField(db_index=<span class="keyword">True</span>)
</code></pre>
<p>Piston, with its default integration, allows you to create a handler which directly ties to a&nbsp;model:</p>
<pre><code class="lang-python"><span class="class"><span class="keyword">class</span> <span class="title">BookHandler</span><span class="params">(BaseHandler)</span>:</span>
     allowed_methods = (<span class="string">'<span class="caps">GET</span>'</span>, <span class="string">'<span class="caps">POST</span>'</span>, <span class="string">'<span class="caps">PUT</span>'</span>, <span class="string">'<span class="caps">DELETE</span>'</span>)
     fields = (<span class="string">'id'</span>, <span class="string">'title'</span>, <span class="string">'author'</span> )
     model = Book
</code></pre>
<p>So far, so good. My problem with this was that I can’t expose the ‘title’ field as ‘book_name’ or anything else if I wanted to. Piston did not have support for inbuilt mappings of such kind. The only way out would have been to write a method like&nbsp;so: </p>
<pre><code class="lang-python"><span class="class"><span class="keyword">class</span> <span class="title">BookHandler</span><span class="params">(BaseHandler)</span>:</span>
     allowed_methods = (<span class="string">'<span class="caps">GET</span>'</span>, <span class="string">'<span class="caps">POST</span>'</span>, <span class="string">'<span class="caps">PUT</span>'</span>, <span class="string">'<span class="caps">DELETE</span>'</span>)
     fields = (<span class="string">'id'</span>, <span class="string">'book_name'</span>, <span class="string">'author'</span> )
     model = Book

<span class="decorator">@staticmethod</span>
     <span class="function"><span class="keyword">def</span> <span class="title">book_name</span><span class="params">(object)</span>:</span>
         <span class="keyword">return</span> object.title
</code></pre>
<p>Which, I felt, was overkill to do each time I wanted a custom field name. So I chose to go ahead and modify the emitters module which processes the input format and returns the output. I have already <a href="https://bitbucket.org/bhashkar/django-piston/">forked</a> piston, but yet have to apply the patch to it. Will do it soon, I promise. I also added Session-based authentication support to it. Now for the same outcome, all you need to do is the&nbsp;following:</p>
<pre><code class="lang-python"><span class="class"><span class="keyword">class</span> <span class="title">BookHandler</span><span class="params">(BaseHandler)</span>:</span>
    allowed_methods = (<span class="string">'<span class="caps">GET</span>'</span>, <span class="string">'<span class="caps">POST</span>'</span>, <span class="string">'<span class="caps">PUT</span>'</span>, <span class="string">'<span class="caps">DELETE</span>'</span>)
    fields = (<span class="string">'id'</span>, { <span class="string">'book_name'</span> : <span class="string">'title'</span> }, <span class="string">'author'</span> )
    model = Book
</code></pre>
<p>That’s right! I added yet another fork to the already present tons of piston forks in the World. C’est la&nbsp;vie.</p>
<p>Peace out,&nbsp;people!</p>
<p>[<strong><span class="caps">PS</span>:</strong> You might be interested in reading this post by the author of Django about the <span class="caps">REST</span> API worst practices: <a href="http://jacobian.org/writing/rest-worst-practices">http://jacobian.org/writing/rest-worst-practices</a>]</p>
</section>
        </article>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="nav"><a href="/">« Back to home</a></div>
        <section class="about"><p>I love the web and open-source; and enjoy building useful things.
I have had the opportunity to give talks on JS-related things we built at <a href="http://mobstac.com">MobStac</a>.</p>
<p>I love books; and sometimes try to write. I enjoy sharing my learnings on <a href="http://quora.com/Bhashkar-Sharma">Quora</a>, among other places.</p>
<p>The excitement of learning new things is the reason I get out of bed in the morning.</p>

        </section>
        <section class="links"><a href="https://twitter.com/bhashkarsharma" class="icon fa-twitter"></a><a href="https://linkedin.com/in/bhashkarsharma" class="icon fa-linkedin"></a><a href="https://github.com/bhashkarsharma" class="icon fa-github"></a><a href="mailto:info@bhashkar.me" class="icon fa-envelope"></a></section>
        <section class="copy">
          <p>&copy; 2015 Bhashkar Sharma &mdash; powered by&nbsp;<a href="https://github.com/jnordberg/wintersmith">Wintersmith</a></p>
        </section>
      </div>
    </footer>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-2340837-4', 'bhashkar.me');
      ga('send', 'pageview');
    </script>
  </body>
</html>